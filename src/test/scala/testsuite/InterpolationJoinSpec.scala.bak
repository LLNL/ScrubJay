package testsuite

import scrubjay.schema._
import scrubjay.datasource._
import org.scalactic.source.Position
import scrubjay.dataset.combination.InterpolationJoin


class InterpolationJoinSpec extends ScrubJaySpec {

  describe("InterpolationJoin") {
    lazy val temp = CSVDatasetID(temperatureFilename, CSVSchema(temperatureMetaFilename))
    lazy val flops = CSVDatasetID(flopsFilename, CSVSchema(flopsMetaFilename))

    describe("Many-to-one projection") {
      lazy val interjoined = InterpolationJoin(flops, temp, 60000)

      it("should be defined") {
        assert(interjoined.isValid)
      }
      it("should match ground truth") {
        assert(interjoined.realize.collect.toSet == trueFlopsJoinTemp)
      }
      it("should pickle/unpickle correctly") {
        assert(DatasetID.fromJsonString(DatasetID.toJsonString(interjoined)) == interjoined)
      }
    }

    describe("One-to-many projection") {
      lazy val interjoined = InterpolationJoin(temp, flops, 60000)

      it("should be defined") {
        assert(interjoined.isValid)
      }
      it("should match ground truth") {
        assert(interjoined.realize.collect.toSet == trueTempJoinFlops)
      }
      it("should pickle/unpickle correctly") {
        assert(DatasetID.fromJsonString(DatasetID.toJsonString(interjoined)) == interjoined)
      }
    }
  }

}
